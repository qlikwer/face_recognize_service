# Face Recognition Service (Docker)

HTTP‚Äë—Å–µ—Ä–≤–∏—Å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ª–∏—Ü –Ω–∞ –±–∞–∑–µ **face_recognition / dlib**, —É–ø–∞–∫–æ–≤–∞–Ω–Ω—ã–π –≤ Docker –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è (–≤ —Ç–æ–º —á–∏—Å–ª–µ –≤ LXC‚Äë–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ Proxmox).

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤–º–µ—Å—Ç–µ —Å **Home Assistant OS** (—á–µ—Ä–µ–∑ REST), –∞ —Ç–∞–∫–∂–µ –∫–∞–∫ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å.

---

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

* üë• –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ **–≤—Å–µ—Ö –ª–∏—Ü –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏**
* üß† –ü–æ–¥–¥–µ—Ä–∂–∫–∞ **–Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ª—é–¥–µ–π**
* üì∏ **–ù–µ—Å–∫–æ–ª—å–∫–æ —Ñ–æ—Ç–æ –Ω–∞ –∫–∞–∂–¥–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞**
* ‚ûï API –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ª—é–¥–µ–π –∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
* üóë API –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ª—é–¥–µ–π
* üíæ –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤–Ω–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (Docker volume)
* üìñ Swagger UI (`/docs`)

---

## üß© –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Home Assistant OS
        |
        | HTTP (REST)
        v
Docker container (Debian)
  ‚îú‚îÄ FastAPI
  ‚îú‚îÄ face_recognition / dlib
  ‚îî‚îÄ faces/ (volume)
```

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç Home Assistant –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –æ—Ç–¥–µ–ª—å–Ω–æ.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

```
faces/
 ‚îú‚îÄ ivan/
 ‚îÇ   ‚îú‚îÄ 1.jpg
 ‚îÇ   ‚îú‚îÄ 2.jpg
 ‚îú‚îÄ maria/
 ‚îÇ   ‚îú‚îÄ a.jpg
 ‚îÇ   ‚îî‚îÄ b.jpg
 ‚îî‚îÄ encodings.pkl
```

* –û–¥–Ω–∞ –ø–∞–ø–∫–∞ = –æ–¥–∏–Ω —á–µ–ª–æ–≤–µ–∫
* –í –ø–∞–ø–∫–µ ‚Äî –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
* `encodings.pkl` ‚Äî –∫–µ—à –∫–æ–¥–∏—Ä–æ–≤–æ–∫ –ª–∏—Ü (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

---

## üê≥ Docker

### –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞

```bash
docker build -t face-recognition-api .
```

### –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```bash
docker run -d \
  --name face-api \
  -p 8000:8000 \
  -v ./faces:/app/faces \
  face-recognition-api
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:

* API: `http://<IP>:8000`
* Swagger UI: `http://<IP>:8000/docs`

---

## üì° API

### üîç –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –ª–∏—Ü

**POST** `/recognize`

* –í—Ö–æ–¥: –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (`multipart/form-data`)
* –í—ã—Ö–æ–¥: —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ª–∏—Ü

–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:

```json
{
  "count": 3,
  "faces": [
    {"id": 0, "name": "ivan"},
    {"id": 1, "name": "unknown"},
    {"id": 2, "name": "maria"}
  ]
}
```

---

### üë§ –î–æ–±–∞–≤–∏—Ç—å —á–µ–ª–æ–≤–µ–∫–∞

**POST** `/person?name=<–∏–º—è>`

–°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é –ø–∞–ø–∫—É —á–µ–ª–æ–≤–µ–∫–∞.

---

### üì∏ –î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ —á–µ–ª–æ–≤–µ–∫—É

**POST** `/person/{name}/photo`

* –í—Ö–æ–¥: –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
* –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ–¥–∏—Ä–æ–≤–∫–∏

---

### üìã –°–ø–∏—Å–æ–∫ –ª—é–¥–µ–π

**GET** `/persons`

–û—Ç–≤–µ—Ç:

```json
["ivan", "maria"]
```

---

### üóë –£–¥–∞–ª–∏—Ç—å —á–µ–ª–æ–≤–µ–∫–∞

**DELETE** `/person/{name}`

–ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è–µ—Ç —á–µ–ª–æ–≤–µ–∫–∞ –∏ –≤—Å–µ –µ–≥–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏.

---

## üè† –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å Home Assistant

–¢–∏–ø–æ–≤–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π:

1. `camera.snapshot`
2. –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–Ω–∏–º–∫–∞ —á–µ—Ä–µ–∑ `rest_command` –Ω–∞ `/recognize`
3. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø–æ –∏–º–µ–Ω–∏ —á–µ–ª–æ–≤–µ–∫–∞ (`ivan`, `unknown`, ‚Ä¶)

–°–µ—Ä–≤–∏—Å —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –≤—ã–Ω–µ—Å–µ–Ω –≤–æ –≤–Ω–µ—à–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, —Ç–∞–∫ –∫–∞–∫ `face_recognition` **–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è** –≤ Home Assistant OS –Ω–∞–ø—Ä—è–º—É—é.

---

## ‚ö†Ô∏è –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

* –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –∏ —Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞ –º–æ–≥—É—Ç –∑–∞–Ω–∏–º–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç (—Å–±–æ—Ä–∫–∞ `dlib`)
* –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –Ω–∞–≥—Ä—É–∂–∞–µ—Ç CPU ‚Äî —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä **–Ω–µ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç** –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

---

## üõ£ –í–æ–∑–º–æ–∂–Ω—ã–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (token / basic auth)
* üìç –í–æ–∑–≤—Ä–∞—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –ª–∏—Ü
* üéØ Confidence score (—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ)
* üë• Top‚ÄëN —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
* üßµ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ CPU / RAM
* üì¶ docker‚Äëcompose

---

## üìú –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –≤ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª—è—Ö.

---
